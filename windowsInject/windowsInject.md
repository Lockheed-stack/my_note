# Windows DLL inject

### 2022.9.26
>之前搞过 hook 注入dll，今天刚好又看到了其他的注入方法，简单记录一下：
>1. 远程线程注入：在其他进程中找到`LoadLibrary`函数，用该进程的函数加载自己的code。
>2. APC注入：APC(Asynchronous Procedure Calls，异步过程调用),APC是函数在特定的线程被异步执行。在Windows中APC是一种并发机制，用于异步的IO或定时器。当处于用户模式的`APC`压入线程`APC`队列后，该线程并不直接调用`APC`函数,除非该线程处于可通知状态，调用的顺序为先入先出。由内核产生的APC称为内核态（kernel-mode）APC，而由用户应用调用的APC称为用户态（user-mode）APC。
>>因此思路就是插入一个APC事件到 APC队列中，等待执行，因此有可能一直等不到。
>
>3. eip 注入：eip是32位的寄存器，此方法是通过修改寄存器来注入自己的code。随机挑选一个正在运行的线程，将该线程挂起，获取到该线程的上下文`context`, 根据中断原理，要记录下线程运行到哪了，此时这个记录就放在`eip`寄存器中，因此修改eip中的地址，换成自己dll运行的地址。之后在中断恢复，就会运行自己的code。

以上这些方法都需要自己去找注入的地方。下面的方法是由系统提供注入的。
>1. 注册表注入：在某个键值中输入dll的路径，那么这个dll就会全局加载，但比较笨重。
>2. hook注入：就是之前玩的。
>3. IME注入：输入法注入，只不过文件名后缀是`.ime`。当在某个进程中切换输入法时，系统会把输入法的DLL注入到该进程中，因此自己写一个伪造的输入法并切换到它，就会注入到进程中。